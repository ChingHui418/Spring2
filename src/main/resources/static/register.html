<!DOCTYPE html>
	<html>
		<head>
		<meta charset="UTF-8">
	<title>Insert title here</title>
	</head>
	<body>
		<h1>Register Page</h1>
		<hr />
		<form id="regForm">
			Email: <input id="email" required="required" />
				<span id="mesg" style="color: red"></span><br />
			Password: <input id="passwd" type="password" required="required" /><br />
			Name: <input id="name" required="required" /><br />
			<input type="submit" value="Register" />
			<span id="result"></span>
		</form>
		<script>
			let email = document.getElementById("email");
			let passwd = document.getElementById("passwd");
			let name = document.getElementById("name");
			let mesg = document.getElementById("mesg");
			let regForm = document.getElementById("regForm");

			email.addEventListener('blur', async () => {
				console.log("OK");
				let url = "/api/members/exist?email=" + email.value;
				let res = await fetch(url);
				let isExist = await res.json()
				console.log(res);
				console.log(isExist);
				mesg.textContent = isExist?"Email 已存在":"";
			});
			
			regForm.addEventListener("submit", async (e)=>{
				e.preventDefault();
				let data = {
					email: email.value,
					passwd: passwd.value,
					name: name.value
				};
				console.log(JSON.stringify(data));
				let url = "api/members/register";
				let res = await fetch(url, {
					method: 'POST',
					headers: {
						"content-Type": "application/json"
					},
					body: JSON.stringify(data)
				});
				let json = await res.json();
				console.log(json);
				if(json.success){
					location.href = "login.html";
				}else {
					result.textContent = "註冊失敗";
				}
				
			});
			
		</script>
	</body>
</html>